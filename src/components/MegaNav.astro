---
import { SITE_TITLE } from "../consts";
---

<div>
  <nav class="main-nav" aria-label="Main">
    <ul>
      <!-- Admissions -->
      <li>
        <button aria-expanded="false">Admissions</button>
        <div class="mega-panel">
          <a href="/admissions" class="section-title">Admissions</a>
          <ul>
            <li>
              <a href="/admissions/requirements-and-procedures"
                >Requirements and procedures</a>
            </li>
            <li><a href="/admissions/visiting-a-s">Visiting A&amp;S</a></li>
            <li>
              <a href="/admissions/a-s-ambassadors">A&amp;S Ambassadors</a>
            </li>
          </ul>
        </div>
      </li>

      <!-- Academics -->
      <li>
        <button aria-expanded="false">Academics</button>
        <div class="mega-panel">
          <a href="/academics" class="section-title">Academics</a>
          <ul>
            <li>
              <a href="/academics/majors-and-minors">Majors and minors</a>
            </li>
            <li>
              <a href="/academics/degree-requirements">Degree requirements</a>
            </li>
            <li>
              <a href="/academics/innovative-curriculum"
                >Innovative curriculum</a>
            </li>
            <li>
              <a href="/academics/beyond-the-classroom">Beyond the classroom</a>
            </li>
            <li><a href="/academics/study-abroad">Study abroad</a></li>
          </ul>
        </div>
      </li>

      <!-- Student Services -->
      <li>
        <button aria-expanded="false">Student Services</button>
        <div class="mega-panel">
          <a href="/student-services" class="section-title">Student Services</a>
          <div>
            <h3>
              <a href="/student-services/academic-advising"
                >Academic Advising</a>
            </h3>
            <ul>
              <li>
                <a
                  href="/student-services/academic-advising/new-student-orientation"
                  >New student orientation</a>
              </li>
              <li>
                <a
                  href="/student-services/academic-advising/ap-ib-a-level-credits"
                  >AP, IB or A-level credits</a>
              </li>
              <li>
                <a
                  href="/student-services/academic-advising/choosing-and-applying-for-majors"
                  >Choosing and applying for majors</a>
              </li>
              <li>
                <a href="/student-services/academic-advising/placement-exams"
                  >Placement exams</a>
              </li>
			  <li><a href="/student-services/academic-advising/test">Pre-health</a></li>
			  <li><a href="/student-services/academic-advising/test">Study abroad</a></li>
            </ul>
          </div>
          <div>
            <h3><a href="/student-services/registrar">Registrar</a></h3>
            <ul>
              <li>
                <a href="/student-services/registrar/course-enrollment"
                  >Course enrollment</a>
              </li>
              <li>
                <a href="/student-services/registrar/academic-policies"
                  >Academic policies</a>
              </li>
              <li>
                <a
                  href="/student-services/registrar/academic-policies/policy-petitions"
                  >Policy Petitions</a>
              </li>
              <li>
                <a href="/student-services/registrar/transferring-credits"
                  >Transferring credits</a>
              </li>
			  <li><a href="/student-services/registrar/test">Graduation</a></li>
			  <li><a href="/student-services/registrar/test">Leave of absence and withdrawl</a></li>
			  <li><a href="/student-services/registrar/test">Important dates</a></li>
			  <li><a href="/student-services/registrar/test">Classroom scheduling</a></li>
            </ul>
          </div>
		  <div>
			<h3><a href="#">Career Development</a></h3>
			<ul>
				<li><a href="/student-services/career-development/pathways-internship-program	">Pathways Internship Program</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Student Funding Opportunities</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">SEG</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Appointments</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Finding and applying for jobs</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Outcomes: Careers after Cornell</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Preprofessional, graduate school and gap years</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">Resources for alumni</a></li>
				<li><a href="/student-services/career-development/pathways-internship-program	">LAUNCJ</a></li>
			</ul>
		  </div>
        </div>
      </li>

      <!-- Research -->
      <li>
        <button aria-expanded="false">Research & Scholarship</button>
        <div class="mega-panel">
          <a href="/research-and-scholarship" class="section-title"
            >Research and Scholarship</a
          >
          <div>
            <h3>
              <a href="/research-and-scholarship/undergraduate-research"
                >Undergraduate Research</a>
            </h3>
            <ul>
              <li>
                <a
                  href="/research-and-scholarship/undergraduate-research/nexus-scholars-program"
                  >Nexus Scholars Program</a>
              </li>
              <li>
                <a
                  href="/research-and-scholarship/undergraduate-research/humanities-scholars-program"
                  >Humanities Scholars Program</a>
              </li>
              <li>
                <a
                  href="/research-and-scholarship/undergraduate-research/tanner-deans-scholars"
                  >Tanner Dean's Scholars</a>
              </li>
              <li>
                <a
                  href="/research-and-scholarship/undergraduate-research/milstein-program"
                  >Milstein Program</a>
              </li>
            </ul>
          </div>
          <div>
            <h3>Fellowships</h3>
            <ul>
              <li>
                <a href="/research-and-scholarship/klarman-fellows"
                  >Klarman Fellows</a>
              </li>
            </ul>
          </div>
        </div>
      </li>
    </ul>
  </nav>
</div>

<style>
  :root {
    --accent: #0055cc;
    --text: #222;
    --bg: #fff;
    --dropdown-bg: #f9f9fb;
    --page-padding: 4vw; /* controls horizontal spacing */
  }

  body {
    font-family: system-ui, sans-serif;
    margin: 0;
    color: var(--text);
  }

  header {
    background: var(--bg);
    border-bottom: 1px solid #ddd;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  nav.main-nav {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    position: relative;
    padding: 0 var(--page-padding);
  }

  nav.main-nav > ul {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  nav.main-nav > ul > li {
    position: static; /* allows full-width dropdowns */
  }

  nav.main-nav > ul > li > button,
  nav.main-nav > ul > li > a {
    background: none;
    border: none;
    font: inherit;
    color: var(--text);
    padding: 1rem 1.25rem;
    cursor: pointer;
  }

  nav.main-nav > ul > li:hover > button,
  nav.main-nav > ul > li:hover > a {
    /* color: var(--accent); */
  }

  nav.main-nav > ul > li > button.active {
    /* color: var(--accent); */
    font-weight: bold;
  }

  .section-title {
    font-size: 1.25em;
    font-weight: bold;
	height: max-content;
  }

  /* --- MEGA PANEL (FULL WIDTH WITH ALIGNED PADDING) --- */
  .mega-panel {
    display: none;
    position: absolute;
    top: 100%;
    left: var(--page-padding);
    width: calc(100% - 4 * var(--page-padding));
    background: var(--dropdown-bg);
    border-top: 1px solid #ddd;
    padding: 2rem 0;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }
  .mega-panel > * {
    max-width: max-content;
  }
  li.open > .mega-panel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 300px));
    gap: 2rem;
    padding: 2rem var(--page-padding);
  }

  .mega-panel h3 {
    margin-top: 0;
    font-size: 1.5rem;
    font-weight: 600;
    /* color: var(--accent); */
	border-bottom: 1px solid #ddd;
  }

  .mega-panel h3.active {
    font-weight: 700;
	border-bottom-color: var(--accent);
  }

  .mega-panel ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .mega-panel a {
    display: block;
    padding: 0.25rem 0;
    color: var(--text);
    text-decoration: none;
  }

  .mega-panel a.active {
    font-weight: bold;
	border-bottom: 2px solid var(--accent);
  }

  .mega-panel a:hover {
    text-decoration: underline;
  }

  /* --- MOBILE --- */
  @media (max-width: 768px) {
    nav.main-nav {
      flex-direction: column;
      align-items: stretch;
    }

    .mega-panel {
      position: static;
      display: none;
      box-shadow: none;
      width: 100%;
      padding: 1rem;
    }

    li.open > .mega-panel {
      display: block;
    }
  }
</style>

<script>
  // Toggle mega panels
  document.querySelectorAll(".main-nav > ul > li > button").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      const li = e.target.closest("li");
      const open = li.classList.contains("open");
      document
        .querySelectorAll(".main-nav > ul > li")
        .forEach((l) => l.classList.remove("open"));
      if (!open) li.classList.add("open");
      document
        .querySelectorAll(".main-nav > ul > li > button")
        .forEach((b) => b.setAttribute("aria-expanded", "false"));
      if (!open) e.target.setAttribute("aria-expanded", "true");
    });
  });

  // hilight current page's section in mega menu
  const currentPath = window.location.pathname;
  document.querySelectorAll(".main-nav a").forEach((link) => {
    const href = link.getAttribute("href");
    if (
      href === currentPath ||
      (href !== "/" && currentPath.startsWith(href))
    ) {
      link.classList.add("active");
      
      // Add active class to parent h3 if it exists
      const parentH3 = link.closest("h3");
      if (parentH3) {
        parentH3.classList.add("active");
      }
      
      // Add active class to the top-level button for this section
      const megaPanel = link.closest(".mega-panel");
      if (megaPanel) {
        const parentLi = megaPanel.closest("li");
        const button = parentLi?.querySelector("button");
        if (button) {
          button.classList.add("active");
        }
      }
    }
  });

  // Close on outside click
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".main-nav")) {
      document
        .querySelectorAll(".main-nav > ul > li")
        .forEach((l) => l.classList.remove("open"));
      document
        .querySelectorAll(".main-nav > ul > li > button")
        .forEach((b) => b.setAttribute("aria-expanded", "false"));
    }
  });
</script>
